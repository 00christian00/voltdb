package pmsg;
option java_package = "org.voltdb.pmsg";
option java_outer_classname = "DRAgent";

message Ack {
    optional int32 partitionId = 1;
    optional fixed64 timestamp = 2;
}

message Reset {
    optional int32 partitionId = 1;
    optional fixed64 timestamp = 2;
}

message Pause {
    optional int32 partitionId = 1;
}

message Response {
    // all known nodes globally
    //  first entry is self
    repeated NodeInfo nodeInfo = 1;
    optional int32 globalPartitionCount = 2;
    // local partitions
    repeated PartitionInfo partitionInfo = 3;
}

message NodeInfo {
    optional string hostname = 1;
    optional int32 drport = 2;
}

message PartitionInfo {
    optional int32 partitionId = 1;
    optional fixed64 oldestTimestamp = 2;
    optional fixed64 lastSentTimestamp = 3;
    optional int64 outstandingBufferCount = 4;
    optional int64 outstandingByteCount = 5;
    optional bool isPaused = 6;
}

message CtrlEnvelope {
    enum Type {
        ACK = 1;
        RESET = 2;
        PAUSE = 3;
        QUERY = 4;
        RESPONSE = 5;
    }
    required Type type = 1;
    optional Ack ack = 2;
    optional Reset reset = 3;
    optional Pause pause = 4;
    optional Response response = 5;
}
