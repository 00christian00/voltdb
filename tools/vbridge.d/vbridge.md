# VBridge - VoltDB Database Porting Tool


## Introduction

VoltDB VBridge provides a quick start for users with existing non-VoltDB
databases.

VBridge ports foreign schemas to VoltDB and creates simple working
starter projects. Starter projects run out of the box on a single host,
and can grow to include user-provided stored procedures and client
applications.

Please note this VBridge pre-release is experimental. It only supports
MySQL schema import. Other products will be supported in the future.

As an experimental component VBridge has not been exhaustively tested.
Please thoroughly check all generated code before using it in an
application.

This documentation provides an overview of the tool and some basic
usage. It does not completely document all settings and options. It
should provide enough information to get started.


## Prerequisites

Similar to "voltadmin", VBridge requires Python 2.6 or 2.7.


## How VBridge Works

VBridge is a Python shell script based on the same modular command
framework as voltadmin. It runs in a virtual environment with all
library dependencies resolved locally. It does not affect system-wide
Python libraries. It does not require root access.

The first run builds a virtual environment and downloads and installs
library dependencies. Internet access is required for the "pip" package
manager to be able to download the needed installation packages.

VBridge runs as a database client to connect to a server and scan system
tables in order to acquire a schema. It cannot parse DDL source code.

VBridge automatically saves and uses a volt.cfg properties file that
provides all configuration options.

### Partitioning

Since VoltDB is a distributed database its schema needs to know how to
partition tables, i.e. which tables get partitioned and which column to
use as the partitioning key.

VBridge attempts to deduce partitioning by analyzing source schema
foreign key relationships. It starts with a single "partitioning table"
as the focal point and follows foreign key relationships to other
tables. It guesses that strongly-related tables have data that will
partition based on their related keys.

Either an explicit partitioning table may be specified in the
configuration (with the "partition_table" property) or VBridge will use
the table with the largest row count as a guess. If your database is
empty or doesn't have representative data you will want to explicitly
specify a partitioning table for best results.


## Generated Files

VBridge generates the following project files.

### ddl.sql

This file is a heavily annotated VoltDB schema definition. The
annotations point out important choices made during code generation,
including data type conversions. It is well worth trying to understand
these choices.  The conversion is not one to one.

### deployment.xml

This file supplies an initial minimal VoltDB deployment configuration
for 1 host and 2 sites.

### run.sh

This file is a Bash script that makes it more convenient to build the
VoltDB catalog and run the server.

Please note that if you change the number of hosts in the deployment
file and or wish to use a server other than localhost you may want to
update run.sh. It is hard-coded for localhost.

### vbridge-README.txt

This file has some basic information related to the code generated by
VBridge.

### volt.cfg

This file is automatically saved and loaded by VBridge to manage
configuration properties.

It uses the INI file format. Configuration properties use "name = value"
syntax under a [vbridge] section header. Spacing is not significant and
quotes are not needed.

The volt.cfg file can be managed with the "vbridge config" sub-command.
It can also be hand-edited.


## Getting Help

VBridge has a full command line help system accessible through the
"help" sub-command or the -h option.

### Getting Basic Help

    vbridge help

### Getting Sub-Command Help

    vbridge help (subcommand)

For example, to get help with the porting tool:

    vbridge help port


## Basic Usage

The basic sequence is as follows.

1. Make sure the source database is running.
1. Generate an initial configuration.
1. Update the configuration to provide a connection string and possibly
   a partitioning table.
1. Port the source database (and generate project files).
1. Examine or edit the generated files, particularly ddl.sql.

### Sample Session

    $ mkdir myproject

    $ cd myproject

    $ sudo mysql.server start     (if it's not running)
    Starting MySQL
     SUCCESS!

    $ vbridge port

    The following settings must be configured before proceeding:

       PROPERTY           DESCRIPTION
       -----------------  --------------------------
       connection_string  database connection string

    The following setting defaults were applied and saved permanently:

       PROPERTY         VALUE
       ---------------  --------------
       ddl_file         ddl.sql
       deployment_file  deployment.xml
       host_count       1
       kfactor          0
       package          voltapp
       partition_table  AUTO
       run_script       run.sh
       sites_per_host   2
       source_type      mysql

    Use the "config" verb to modify and view properties as follows.

    To set a property (using actual property name):
       vbridge config set connection_string=CONNECTION_STRING_VALUE

    To display one, many, or all properties:
       vbridge config get name
       vbridge config get name1 name2 ...
       vbridge config get

    To get "config" command help:
       vbridge help config

    You can also edit "volt.cfg" directly in a text editor.

    $ vbridge config set connection_string=mysql://root@localhost/demo
    set vbridge.connection_string=mysql://root@localhost/demo

    $ vbridge config set partition_table=Customer
    set vbridge.partition_table=Customer

    $ vbridge config get
    vbridge.connection_string=mysql://root@localhost/employees
    vbridge.ddl_file=ddl.sql
    vbridge.deployment_file=deployment.xml
    vbridge.host_count=1
    vbridge.kfactor=0
    vbridge.package=voltapp
    vbridge.partition_table=Customer
    vbridge.run_script=run.sh
    vbridge.sites_per_host=2
    vbridge.source_type=mysql

    $ vbridge port
    INFO: Generating "vbridge-README.txt"...
    INFO: Generating "deployment.xml"...
    INFO: Generating "run.sh"...
    INFO: Generating "ddl.sql"...
    INFO: Generating "src/com/voltapp/Client.java"...
    INFO: Project files were generated successfully.
    INFO: Please examine the following files thoroughly before using.
    INFO:   vbridge-README.txt
    INFO:   deployment.xml
    INFO:   run.sh
    INFO:   ddl.sql
    INFO:   src/com/voltapp/Client.java
